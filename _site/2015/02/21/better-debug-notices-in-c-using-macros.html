<!DOCTYPE html><html lang="en" manifest="/manifest.appcache"> <!-- Magic. Do not touch! (c) 2011-2016 Maciej A. Czyzewski --><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><meta name="robots" content="index, follow, archive" /><meta name="referrer" content="always" /><title>Better debug notices in C, using macros - Maciej A. Czyzewski on the Web</title><meta property="og:title" content="Better debug notices in C, using macros" /><meta name="description" content="In almost every programming language handling errors is a difficult activity, but very important." /><meta property="og:description" content="In almost every programming language handling errors is a difficult activity, but very important." /><link rel="canonical" href="http://maciejczyzewski.me/2015/02/21/better-debug-notices-in-c-using-macros.html" /><meta property="og:url" content="http://maciejczyzewski.me/2015/02/21/better-debug-notices-in-c-using-macros.html" /><meta property="og:site_name" content="Maciej A. Czyzewski on the Web" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2015-02-21T17:03:22+01:00" /><link rel="next" href="http://maciejczyzewski.me/2015/08/22/finding-files-right-way-using-command-line-utility.html" title="Finding files, right way using command-line utility..." /><link rel="prev" href="http://maciejczyzewski.me/2015/01/12/sieve-of-atkin-finding-prime-numbers-faster.html" title="Sieve of Atkin, finding prime numbers faster" /><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@_czyzewski" /><meta name="google-site-verification" content="HBawTMww3xGdm4ZIKokBD8_Bx3YudVqrv1PISdhnthE" /> <script type="application/ld+json"> { "@context": "http://schema.org", "@type": "BlogPosting", "headline": "Better debug notices in C, using macros", "datePublished": "2015-02-21T17:03:22+01:00", "description": "In almost every programming language handling errors is a difficult activity, but very important.", "logo": "http://maciejczyzewski.me/assets/images/shortcuts/144.png", "url": "http://maciejczyzewski.me/2015/02/21/better-debug-notices-in-c-using-macros.html" } </script><link type="application/atom+xml" rel="alternate" href="http://maciejczyzewski.me/feed.xml" title="Maciej A. Czyzewski on the Web" /><link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic" /> <script type="text/x-mathjax-config"> MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}}); </script> <script type="text/javascript" async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML"></script><link media="all" rel="stylesheet" type="text/css" href="/assets/styles.css" /></head><line></line><header> <a href="/">Maciej A. Czyzewski</a> <a href="/archive">Archive</a> <a href="/research">Research</a> <a href="/projects">Projects</a> <a href="/talks">Talks</a> <a href="/about">About</a></header><main><article><h1>Better debug notices in C, using macros</h1><hgroup> <span>Posted on <time datetime="">21 February 2015</time></span> <a href="https://twitter.com/share" class="twitter-share-button" data-via="_czyzewski" data-size="large">Tweet</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script></hgroup><div><p>In almost every programming language handling errors is a difficult activity, but very important.</p><p>Last day, I was exploring some small projects on <strong>Github</strong>. Most didn’t have any notifications, the rest had some creative solutions. Their problem was that they were unreadable.</p><p>So below I present my simple solution, using macros.</p><h2 id="implementation">Implementation</h2><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#include &lt;stdlib.h&gt;</span>

<span class="sr">/* Debugger */</span>

<span class="c1">#define note(S, ...) fprintf(stderr,                                     \</span>
  <span class="s2">"</span><span class="se">\x1b</span><span class="s2">[1m(%s:%d, %s)</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">  </span><span class="se">\x1b</span><span class="s2">[1m</span><span class="se">\x1b</span><span class="s2">[90mnote:</span><span class="se">\x1b</span><span class="s2">[0m "</span> <span class="no">S</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span>    <span class="p">\</span>
  <span class="kp">__FILE__</span><span class="p">,</span> <span class="kp">__LINE__</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">,</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define warn(S, ...) fprintf(stderr,                                     \</span>
  <span class="s2">"</span><span class="se">\x1b</span><span class="s2">[1m(%s:%d, %s)</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">  </span><span class="se">\x1b</span><span class="s2">[1m</span><span class="se">\x1b</span><span class="s2">[33mwarning:</span><span class="se">\x1b</span><span class="s2">[0m "</span> <span class="no">S</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="p">\</span>
  <span class="kp">__FILE__</span><span class="p">,</span> <span class="kp">__LINE__</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">,</span> <span class="c1">##__VA_ARGS__)</span>

<span class="c1">#define errn(S, ...) do { fprintf(stderr,                                \</span>
  <span class="s2">"</span><span class="se">\x1b</span><span class="s2">[1m(%s:%d, %s)</span><span class="se">\x1b</span><span class="s2">[0m</span><span class="se">\n</span><span class="s2">  </span><span class="se">\x1b</span><span class="s2">[1m</span><span class="se">\x1b</span><span class="s2">[31merror:</span><span class="se">\x1b</span><span class="s2">[0m "</span> <span class="no">S</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span>   <span class="p">\</span>
  <span class="kp">__FILE__</span><span class="p">,</span> <span class="kp">__LINE__</span><span class="p">,</span> <span class="n">__FUNCTION__</span><span class="p">,</span> <span class="c1">##__VA_ARGS__); exit(1); } while (0) \</span></code></pre></figure><h2 id="testing">Testing</h2><figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include "utils.h" // debugger macros</span>

<span class="n">int</span> <span class="n">main</span><span class="p">(</span><span class="n">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span> <span class="n">const</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">note</span><span class="p">(</span><span class="s2">"this will be a hard error in the future"</span><span class="p">);</span>
  <span class="nb">warn</span><span class="p">(</span><span class="s2">"function '%s' redefined as non-inline"</span><span class="p">,</span> <span class="s2">"my_function"</span><span class="p">);</span>
  <span class="n">errn</span><span class="p">(</span><span class="s2">"no such file or directory"</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure><h2 id="results">Results</h2><p><img src="https://lh3.googleusercontent.com/vdmeGth8VMAx0r8T-s-4F5N6dNi_ohig_1bxgE5Nx2s7PyfdiKxKBPyzi8PVUPNX6kdTJzf-QAGah8KZdvhwkuVt4KaBM6LaBxic_TesF4eclOIivt59hcU62uumpk6nmFqTy6OkL1GqZgXqp6FEokVgS2JjcEI6YeQvF5nEEghRpc7fEbzPQ6w02nGqw34ftnc-26PHFhsyudiIs6EMHw44RRrEYwvogPv4Ltlt3CnijptgVuBYvqHH4pRFn4cauIn0EvBz1NR0ZjJIDdzu50Z3dSi-K9J2b94QMfwEQuEWuFp1wXyAJAEZZEkoA6OIXwokKbE0ghDtrmGkDg3gpmUo8OUVTf0D302eJy1Zo8Wqb6UvN5nHvcnKDKpbmGDiB1voJXuu0Kz0SdgdUpFLJ6D0V4pR7xjINqRs7Prt2YG0ldy4_gia-BC0x7z5NCfqMkTmBdhwYkVegTOEa1yLjIvCrGNnH9m8eonzVUYt_iNVF3N8rfoSA_b66Tn3p1RegPnTKIuMJNKS7hiDJDUVFiDPGcMig7nD99WIUqJJ6bRzXgdNPCaa6oZJhEbFTmZ5yVGNbHsKEjMsa776Ft54AuwJWahrr18=w1504-h786-no" alt="Testing" /></p><blockquote><p>Please… Start doing it legibly, do nice notices! They have to facilitate the work. That’s why they are.</p></blockquote><h2 id="thanks">Thanks</h2><p><strong>Bill Lynch</strong> - Improved code, found a bug.</p></div><nav> <a href="/2015/01/12/sieve-of-atkin-finding-prime-numbers-faster.html"><p>« previus</p><span>Sieve of Atkin, finding prime numbers faster</span> </a> <a href="/2015/08/22/finding-files-right-way-using-command-line-utility.html"><p>next »</p><span>Finding files, right way using command-line utility...</span> </a></nav></article></main><footer> (c) 2016 <a href="/feed.xml"><svg viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414"><path d="M12.8 16C12.8 8.978 7.022 3.2 0 3.2V0c8.777 0 16 7.223 16 16h-3.2zM2.194 11.61c1.21 0 2.195.985 2.195 2.196 0 1.21-.985 2.194-2.196 2.194C.984 16 0 15.017 0 13.806c0-1.21.983-2.195 2.194-2.195zM10.606 16h-3.11c0-4.113-3.383-7.497-7.496-7.497v-3.11c5.818 0 10.606 4.79 10.606 10.607z"/></svg></a></footer><script type="text/javascript">(function(e,t,n,r,i,s,o){e["GoogleAnalyticsObject"]=i;e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date;s=t.createElement(n),o=t.getElementsByTagName(n)[0];s.async=1;s.src=r;o.parentNode.insertBefore(s,o)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-55884794-1","auto");ga("send","pageview")</script></body></html>
